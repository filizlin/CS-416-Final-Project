<!DOCTYPE html>
<html>
<head>
  <title>Scatter Plot: academicYear vs perc</title>
  <!-- Include D3.js library -->
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
  <div id="scatterPlot"></div>
  <div>
    <button id="prevButton">Previous</button>
    <button id="nextButton">Next</button>
  </div>

  <script>
    // Define the URL for the data
    const dataURL = 'https://raw.githubusercontent.com/filizlin/CS-416-Final-Project/main/Ethnic%20data.csv';

    // Define the size of the SVG canvas
    const width = 800;
    const height = 600;
    const margin = { top: 50, right: 50, bottom: 50, left: 50 };
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;

    // Append the SVG canvas to the 'scatterPlot' div
    const svg = d3.select('#scatterPlot')
      .append('svg')
      .attr('width', width)
      .attr('height', height);

    // Create a group for the plot area
    const plotArea = svg.append('g')
      .attr('transform', `translate(${margin.left}, ${margin.top})`);

    // Load the data from the provided URL
    d3.csv(dataURL).then(data => {
      // Convert string data to numeric values
      data.forEach(d => {
        d.academicYear = +d.academicYear;
        d.perc = +d.perc;
      });

      // Define the scales for the axes
      const xScale = d3.scaleLinear()
        .domain(d3.extent(data, d => d.academicYear))
        .range([0, innerWidth])
        .nice();

      const yScale = d3.scaleLinear()
        .domain([0, d3.max(data, d => d.perc)])
        .range([innerHeight, 0])
        .nice();

      // Create the axes
      const xAxis = d3.axisBottom(xScale);
      const yAxis = d3.axisLeft(yScale);

      // Append the axes to the SVG
      plotArea.append('g')
        .attr('class', 'x-axis')
        .attr('transform', `translate(0, ${innerHeight})`)
        .call(xAxis);

      plotArea.append('g')
        .attr('class', 'y-axis')
        .call(yAxis);

      // Function to update the plot based on selected academic years
      function updatePlot(academicYearStart, academicYearEnd) {
        // Filter data based on selected academic years
        const filteredData = data.filter(d => d.academicYear >= academicYearStart && d.academicYear <= academicYearEnd);

        // Create the dots for the scatter plot
        const dots = plotArea.selectAll('circle')
          .data(filteredData, d => d.subgroup);

        // Update existing circles
        dots.attr('cx', d => xScale(d.academicYear))
          .attr('cy', d => yScale(d.perc));

        // Add new circles
        dots.enter()
          .append('circle')
          .attr('cx', d => xScale(d.academicYear))
          .attr('cy', d => yScale(d.perc))
          .attr('r', 5)
          .attr('fill', 'blue')
          .on('mouseover', showTooltip)
          .on('mouseout', hideTooltip);

        // Remove any extra circles
        dots.exit().remove();
      }

      // Initial plot update for the first slide (2015-2017)
      updatePlot(2015, 2017);

      // Variables to keep track of the current slide and academic years
      let currentSlide = 0;
      const academicYearSlides = [
        { start: 2015, end: 2017 },
        { start: 2015, end: 2019 },
        { start: 2015, end: 2021 }
      ];

      // Function to transition to the next slide
      function nextSlide() {
        currentSlide = (currentSlide + 1) % academicYearSlides.length;
        const { start, end } = academicYearSlides[currentSlide];
        updatePlot(start, end);
      }

      // Function to transition to the previous slide
      function prevSlide() {
        currentSlide = (currentSlide - 1 + academicYearSlides.length) % academicYearSlides.length;
        const { start, end } = academicYearSlides[currentSlide];
        updatePlot(start, end);
      }

      // Attach onclick events to the buttons
      document.getElementById('prevButton').onclick = prevSlide;
      document.getElementById('nextButton').onclick = nextSlide;

      // Tooltip
      const tooltip = d3.select('body')
        .append('div')
        .style('position', 'absolute')
        .style('padding', '8px')
        .style('background-color', 'rgba(0, 0, 0, 0.7)')
        .style('color', 'white')
        .style('font-size', '12px')
        .style('pointer-events', 'none')
        .style('opacity', 0);

      function showTooltip(event, d) {
        const tooltipContent = `
          Academic Year: ${d.academicYear}<br>
          Perc: ${d.perc}
        `;

        tooltip.html(tooltipContent)
          .style('left', (event.pageX + 10) + 'px')
          .style('top', (event.pageY - 10) + 'px')
          .style('opacity', 1);
      }

      function hideTooltip() {
        tooltip.style('opacity', 0);
      }

    });
  </script>
</body>
</html>